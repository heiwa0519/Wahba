% 2020/11/6
clc
clear
close all

% Measurement and inertial vectors
r = zeros(3,3,12); % Inertial frame
b = zeros(3,3,12); % Body fixed frame

% Solution of Wahba's problem
C_hat = zeros(3,3,12);  % DCM
q_hat = zeros(4,12);    % Quaternion

% Two unit vectors known in inertial frame
r(:,:,1)  = [1,0,0; 0,1,0; 0,0,1]';
r(:,:,2)  = [1,0,0; 0,1,0]';
r(:,:,3)  = [1,0,0; 0,1,0; 0,0,1]';
r(:,:,4)  = [1,0,0; 0,1,0]';
r(:,:,5)  = [0.6,0.8,0; 0.8,-0.6,0]';
r(:,:,6)  = [1,0,0; 0,0.01,0; 0,0,0.01]';
r(:,:,7)  = [1,0,0; 0,0.01,0]';
r(:,:,8)  = [1,0,0; 0,0.01,0; 1,0,0.01]';
r(:,:,9)  = [1,0,0; 1,0.01,0]';
r(:,:,10) = [1,0,0; 0.96,0.28,0; 0.96,0,0.28]';
r(:,:,11) = [1,0,0; 0.96,0.28,0]';
r(:,:,12) = [1,0,0; 0.96,0.28,0]';

% Weights
w(1) = 1e-6*[1,1,1]';
w(2) = 1e-6*[1,1]';
w(3) = 0.01*[1,1,1]';
w(4) = 0.01*[1,1]';
w(5) = [1e-6,0.01]';
w(6) = 1e-6*[1,1,1]';
w(7) = 1e-6*[1,1]';
w(8) = 0.01*[1,1,1]';
w(9) = 0.01*[1,1]';
w(10) = [1e-6,0.01,0.01]';
w(11) = [1e-6,0.01]';
w(12) = [0.01,1e-6]';

% Ground truths
q_true = dcm_2_quaternion(C_true);  % Quaternion
C_true = ...                        % DCM
    [0.352, 0.864,0.360; ...
    -0.864, 0.152, 0.480; ...
    0.360, -0.480, 0.800];

for i_iters = 1:12
  b(:,:,i_iters)  = C_true*r(:,:,i_iters);
  [C_hat(:,:,i_iters), q_hat(:,i_iters)] = quest1981(b_1, r_1, w_1);
end
